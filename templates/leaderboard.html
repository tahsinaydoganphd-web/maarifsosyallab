<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liderlik Tablosu</title>
    <style> 
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; } 
    select:disabled { background-color: #f3f4f6; cursor: not-allowed; }
    #admin-panel { display: none; }

    /* YENİ EKLENEN KURAL */
    .no-bounce {
        overscroll-behavior: none;
    }
</style>
</head>
<body class="flex h-screen">
    
    <!-- Sol Dikey Menü -->
    <aside class="w-72 bg-white text-gray-800 shadow-lg flex flex-col fixed h-full">
    <div class="px-6 py-4 border-b border-gray-200">

        <h1 class="text-2xl font-extrabold text-blue-600 text-center tracking-wide mb-4">
            Maarif SosyalLab
        </h1>

        <div class="mb-4">
                <div class="w-full p-2 flex items-center justify-center overflow-hidden">
                    <img src="/videolar/maarif.png"  
                         alt="Maarif Logo" 
                         class="w-auto h-auto max-w-full max-h-24 object-contain rounded-lg">
                </div>
            </div>

        <div class="flex items-center">
                <div id="user-avatar-initial" class="w-10 h-10 rounded-full bg-cyan-500 flex items-center justify-center text-white font-bold text-lg">K</div>
                <div class="ml-3">
                    <span id="user-name-placeholder" class="block text-sm font-bold text-gray-800">Kullanıcı</span>
                    <!-- Dropdown kaldırıldı -->
                </div>
            </div>
        </div>
        <nav class="flex-1 overflow-y-auto p-2 space-y-1 no-bounce">

        <a href="/metin-analiz" class="flex items-center mx-2 p-2 rounded-lg text-white font-semibold bg-blue-500 hover:bg-blue-600 transition-all">
            <i class="fa-solid fa-file-pen mr-3 w-6 text-center"></i>
            <span>Metin Analiz</span>
        </a>
        <a href="/soru-uretim" class="flex items-center mx-2 p-2 rounded-lg text-white font-semibold bg-green-500 hover:bg-green-600 transition-all">
            <i class="fa-solid fa-circle-question mr-3 w-6 text-center"></i>
            <span>Soru Üretim</span>
        </a>
        <a href="/metin-olusturma" class="flex items-center mx-2 p-2 rounded-lg text-white font-semibold bg-purple-500 hover:bg-purple-600 transition-all">
            <i class="fa-solid fa-wand-magic-sparkles mr-3 w-6 text-center"></i>
            <span>Metin Oluşturma</span>
        </a>
        <a href="/haritada-bul" class="flex items-center mx-2 p-2 rounded-lg text-white font-semibold bg-orange-500 hover:bg-orange-600 transition-all">
            <i class="fa-solid fa-map-location-dot mr-3 w-6 text-center"></i>
            <span>Haritada Bul</span>
        </a>
        <a href="/podcast_paneli" class="flex items-center mx-2 p-2 rounded-lg text-white font-semibold bg-red-500 hover:bg-red-600 transition-all">
            <i class="fa-solid fa-microphone-lines mr-3 w-6 text-center"></i>
            <span>Podcast Yap</span>
        </a>
        <a href="/seyret-bul-liste" class="flex items-center mx-2 p-2 rounded-lg text-white font-semibold bg-indigo-500 hover:bg-indigo-600 transition-all">
            <i class="fa-solid fa-magnifying-glass-plus mr-3 w-6 text-center"></i>
            <span>Seyret Bul</span>
        </a>
        <a href="/yarisma-secim" class="flex items-center mx-2 p-2 rounded-lg text-white font-semibold bg-teal-600 ring-2 ring-teal-300 transition-all">
            <i class="fa-solid fa-trophy mr-3 w-6 text-center"></i>
            <span>Beceri/Değer Avcısı</span>
        </a>

    </nav>
        <div class="p-4 border-t border-gray-200">
            <a href="/dashboard" class="flex items-center mx-2 p-2 rounded-lg text-gray-600 font-semibold bg-gray-100 hover:bg-gray-200 transition-all">
                <i class="fa-solid fa-arrow-left mr-3 w-6 text-center"></i>
                <span>Panele Geri Dön</span>
            </a>
        </div>
    </aside>

    <!-- Ana İçerik Alanı -->
    <main class="ml-72 flex-1 p-6 md:p-8 overflow-y-auto no-bounce">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">Liderlik Tablosu (Bireysel Yarışma)</h2>
        <div class="bg-white p-6 rounded-lg shadow">
            <table class="w-full text-left">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="p-3 font-semibold text-sm text-gray-600">Sıra</th>
                        <th class="p-3 font-semibold text-sm text-gray-600">Soyisim</th>
                        <th class="p-3 font-semibold text-sm text-gray-600">Okul / Şube</th>
                        <th class="p-3 font-semibold text-sm text-gray-600">Doğru Soru</th>
                        <th class="p-3 font-semibold text-sm text-gray-600">Rozetler</th>
                        <th class="p-3 font-semibold text-sm text-gray-600">Toplam Süre (sn)</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body" class="divide-y">
                    <!-- JS ile yüklenecek -->
                    <tr><td colspan="6" class="p-4 text-center text-gray-500">Yükleniyor...</td></tr>
                </tbody>
            </table>
        </div>
    </main>
    
    <script>
        // Paneldeki kullanıcı adını yükleme
        document.addEventListener('DOMContentLoaded', () => {
            // --- GÜNCELLEME: Değişken adı "userSoyad" -> "userFullName" oldu ---
            const userFullName = localStorage.getItem('loggedInUserName'); 
            if (userFullName) {
                const namePlaceholder = document.getElementById('user-name-placeholder');
                const avatarInitial = document.getElementById('user-avatar-initial');
                
                if (namePlaceholder) {
                    namePlaceholder.textContent = userFullName; // Değişti
                }
                if (avatarInitial) {
                    // İlk harfi al (Adın ilk harfi)
                    avatarInitial.textContent = userFullName[0] ? userFullName[0].toUpperCase() : 'K'; // Değişti
                }
            }
            // --- GÜNCELLEME BİTTİ ---
            
            // Liderlik tablosunu yükle
            loadLeaderboard();
        });

        async function loadLeaderboard() {
        const tbody = document.getElementById('leaderboard-body');

        // --- YENİ (AŞAMA 4.1) ---
        const userRole = localStorage.getItem('loggedInUserRole');
        const userClass = localStorage.getItem('loggedInUserClass'); // Öğretmenin sınıfını al

        let apiUrl = '/api/get_leaderboard'; // Varsayılan (herkesi göster)

        // Eğer giriş yapan öğretmense, API URL'ini değiştir
        if (userRole === 'teacher' && userClass) {
            apiUrl = `/api/get_leaderboard?class=${userClass}`;
        }
        // --- BİTTİ ---

        try {
            // API URL'i artık dinamik
            const response = await fetch(apiUrl); 
            const result = await response.json();

            if (result.success) {
                tbody.innerHTML = ''; // Temizle

                // --- YENİ (AŞAMA 4.1) ---
                // Eğer öğretmense ve 'top_5' verisi geldiyse onu göster
                if (userRole === 'teacher' && result.top_5) {
                     if (result.top_5.length === 0) {
                        tbody.innerHTML = `<tr><td colspan="6" class="p-4 text-center text-gray-500">Sınıfınızda (${userClass}) henüz kimse yarışmamış.</td></tr>`;
                        return;
                    }

                    result.top_5.forEach((entry, index) => {
                        const row = `
                            <tr class="hover:bg-gray-50">
                                <td class="p-3 font-bold">${index + 1}</td>
                                <td class="p-3">${entry.soyisim}</td>
                                <td class="p-3">${entry.okul} / ${entry.sube}</td>
                                <td class="p-3 font-semibold text-blue-600">${entry.dogru_soru}</td>
                                <td class="p-3">${entry.rozetler}</td>
                                <td class="p-3">${entry.toplam_sure} sn</td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });

                } 
                // Eğer öğrenciyse (veya genel) 'leaderboard' verisini göster
                else if (result.leaderboard) {
                    if (result.leaderboard.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" class="p-4 text-center text-gray-500">Henüz kimse yarışmamış.</td></tr>';
                        return;
                    }

                    result.leaderboard.forEach((entry, index) => {
                        const row = `
                            <tr class="hover:bg-gray-50">
                                <td class="p-3 font-bold">${index + 1}</td>
                                <td class="p-3">${entry.soyisim}</td>
                                <td class="p-3">${entry.okul} / ${entry.sube}</td>
                                <td class="p-3 font-semibold text-blue-600">${entry.dogru_soru}</td>
                                <td class="p-3">${entry.rozetler}</td>
                                <td class="p-3">${entry.toplam_sure} sn</td>
                            </tr>
                        `;
                        tbody.innerHTML += row;
                    });
                }
                // --- BİTTİ ---

            } else {
                tbody.innerHTML = `<tr><td colspan="6" class="p-4 text-center text-red-500">Hata: ${result.message}</td></tr>`;
            }
        } catch (e) {
            console.error("Liderlik tablosu hatası:", e);
            tbody.innerHTML = '<tr><td colspan="6" class="p-4 text-center text-red-500">Sunucuya bağlanılamadı.</td></tr>';
        }
    }
    </script>
</body>
</html>